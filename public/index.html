<html>
<head>
	<script src='https://cdn.firebase.com/js/client/2.0.4/firebase.js'></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/3.0.0/handlebars.min.js"></script>
	<script src="./javascripts/templates.js"></script>

	<link href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css", rel="stylesheet">
</head>
<body>
	<fb:login-button autologoutlink="true" perms="email,user_birthday,status_update,publish_stream"></fb:login-button>
	<script>
	//fb sdk
window.fbAsyncInit = function() {
	console.log('yomama');
        FB.init({
          appId      : 'your-app-id',
          xfbml      : true,
          version    : 'v2.1'
        });
      };

      (function(d, s, id){
         var js, fjs = d.getElementsByTagName(s)[0];
         if (d.getElementById(id)) {return;}
         js = d.createElement(s); js.id = id;
         js.src = "//connect.facebook.net/en_US/sdk.js";
         fjs.parentNode.insertBefore(js, fjs);
       }(document, 'script', 'facebook-jssdk'));

	//end fb sdk
	</script>
	<div class="handlebars-container"></div>

	<script>
	function getFbData(token) {
		
/*
		var url = 'https://graph.facebook.com/v2.2/me/groups?';
		url += token;
		$.ajax({
			url: url,
			dataType: 'jsonp',
			success: function(error, response) {
				if(error) {
					console.log(error);
				} else {
					console.dir(response);
				}
				//display selector with handlebars
			}
		});
*/
	}

function attachTemplate(response) {
		var apiJSON = JSON.parse(response);
		var template = Handlebars.templates['group_selector'];
		var container = $('.handlebars-container');
		container.append(template(apiJSON));
}

var ref = new Firebase("https://hackenstance.firebaseio.com");
ref.authWithOAuthRedirect("facebook", function(error, authData) {
if (error) {
console.log("Login Failed!", error);
} else {
console.log("Authenticated successfully with payload:", authData);
var id = authData.facebook.id;
var usersRef = ref.child("users/" + id);
usersRef.set(authData);
console.log('token: ' + authData.facebook.accessToken);
getFbData(authData.facebook.accessToken);
}
}, {
remember: "none",
scope: "email, user_about_me, user_groups, user_likes"
});

getFbData()
</script>
</body>
</html>